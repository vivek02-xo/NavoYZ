<% layout("layouts/boilerplate") %>

<style>
.my-orders {
  padding: 6rem 8%;
  max-width: 1000px;
  margin: auto;
}

.order-card {
  margin-top: 2.5rem;
  padding: 2.2rem;
  border-radius: 18px;
  border: 1px solid #e5e7eb;
  background: #ffffff;
}

.order-meta {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.order-meta h3 {
  margin-bottom: 0.4rem;
}

.order-date {
  font-size: 0.85rem;
  color: #64748b;
}

/* ===== TIMELINE ===== */
.order-timeline {
  display: flex;
  gap: 2.5rem;
  margin: 1.8rem 0;
}

.timeline-step {
  display: flex;
  flex-direction: column;
  align-items: center;
  color: #94a3b8;
  font-size: 0.85rem;
}

.timeline-step span {
  width: 14px;
  height: 14px;
  border-radius: 50%;
  background: #e5e7eb;
  margin-bottom: 0.4rem;
}

.timeline-step.active span {
  background: #020617;
}

.timeline-step.active {
  color: #020617;
}

/* ===== TEXT ===== */
.order-label {
  font-weight: 600;
  margin-top: 1rem;
}

.order-text {
  color: #334155;
  line-height: 1.6;
}

.payment {
  margin-top: 0.6rem;
  font-size: 0.9rem;
  color: #475569;
}
</style>

<section class="my-orders">
  <h1>My Orders</h1>

  <% if (orders.length === 0) { %>
    <p>You have no orders yet.</p>
  <% } %>

  <% orders.forEach(order => { %>
    <div class="order-card">

      <!-- HEADER -->
      <div class="order-meta">
        <div>
          <h3><%= order.service.title %></h3>
          <p class="order-date">
            Ordered on <%= order.createdAt.toDateString() %>
          </p>
        </div>

        <div class="payment">
          Payment: <strong><%= order.paymentStatus %></strong>
        </div>
      </div>

      <!-- TIMELINE -->
      <div class="order-timeline">
        <% const steps = ["pending", "in-progress", "delivered"]; %>

        <% steps.forEach(step => { %>
          <div class="timeline-step
            <%= order.status === step || order.statusHistory?.some(s => s.status === step)
              ? "active"
              : "" %>
          ">
            <span></span>
            <p><%= step.replace("-", " ") %></p>
          </div>
        <% }) %>
      </div>

      <!-- DETAILS -->
      <div class="order-label">Current status</div>
      <p class="order-text"><%= order.status %></p>

      <div class="order-label">Requirements</div>
      <p class="order-text"><%= order.requirements %></p>

    </div>
  <% }) %>
</section>
